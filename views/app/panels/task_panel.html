<md-expansion-panel class="margin-horizontal-default" ng-class="task.finishDate ? '':'highlight'">

    <md-expansion-panel-collapsed>
        <div flex layout="row" layout-align="start center" class="click-area" ng-click="task.click($event)">
            <i ng-if="task.caseColor" flex="10" class="material-icons {{task.caseColor}}">label</i>
            <!--<img ng-src="task.icon">-->
            <span flex="40">{{task.caseTitle}}</span>
            <span flex="40">{{task.title}}</span>
            <!--<span flex="30">{{task.formatedDate}}</span>-->
            <i ng-if="task.finishDate && !task.loading" flex="5" class="material-icons color-fg-primary-500">done</i>
            <div ng-if="task.loading" flex="10">
                <md-progress-circular md-mode="indeterminate" class="md-primary" md-diameter="30">
                </md-progress-circular>
            </div>
        </div>
    </md-expansion-panel-collapsed>

    <md-expansion-panel-expanded>

        <md-expansion-panel-header ng-click="task.click($event)">
            <i ng-if="task.caseColor" flex="10" class="material-icons {{task.caseColor}}">label</i>
            <!--<img ng-src="task.icon">-->
            <span flex="40">{{task.caseTitle}}</span>
            <span flex="40">{{task.title}}</span>
            <!--<span flex="30">{{task.formatedDate}}</span>-->
            <i ng-if="task.finishDate && !task.loading" flex="5" class="material-icons color-fg-primary-500">done</i>
            <div ng-if="task.loading" flex="10">
                <md-progress-circular md-mode="indeterminate" class="md-primary" md-diameter="30">
                </md-progress-circular>
            </div>
        </md-expansion-panel-header>
            <md-expansion-panel-content>

                <div layout="row" layout-align="start center" layout-wrap class="cursor-default" ng-if="!task.loading">
                    <div ng-repeat="group in task.dataGroups" layout="row" layout-align="{{group.alignment+' center'}}" layout-wrap flex="100">
                        <!--<data-group-divider title="{{group.title}}"></data-group-divider>-->
                        <div layout="row" layout-align="start center" style="margin-top: 20px;margin-bottom: 10px;" flex="100" ng-if="group.title">
                            <div flex="20" style="height: 3px;background-color: rgba(18, 178, 210, .50);"></div>
                            <span style="margin-left: 7px;margin-right: 7px;">{{group.title}}</span>
                            <div flex style="height: 3px;background-color: rgba(18, 178, 210, .50);"></div>
                        </div>
                        <div ng-repeat="field in group.data | orderBy:'order'" flex="50" flex-sm="100"
                             ng-if="!field.behavior.hidden">
                            <div ng-include="'views/app/datafields/field_input_'+field.type+'.html'" ng-cloak flex></div>
                        </div>
                    </div>
                </div>
                <div layout="row" layout-align="center center" ng-if="task.data.length === 0 && !task.loading">
                    <span>This task has no data. Finish to continue.</span>
                </div>

            </md-expansion-panel-content>

            <md-expansion-panel-footer>
                <div flex></div>
                <md-button ng-if="task.user.email === $user.login && task.status !== 'Done'" ng-click="task.save()">
                    Save
                </md-button>
                <md-button ng-if="task.user.email === $user.login && task.status !== 'Done'" ng-click="task.finish()">
                    Finish
                </md-button>
                <md-button class="md-primary" ng-click="task.click($event)">
                    Collapse
                </md-button>
            </md-expansion-panel-footer>

    </md-expansion-panel-expanded>

</md-expansion-panel>